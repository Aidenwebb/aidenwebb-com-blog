---
title: "Cve-2023-23397 - Quickly Check Vulnerability Status and Trigger Updates"
date: 2023-03-15T14:45:08Z
draft: false
# weight: 1
# aliases: ["/first"]
tags: ["Security", "Powershell", "Scripting", "IT & Tech"]
author: "Aiden Arnkels-Webb"
# author: ["Me", "You"] # multiple authors
showToc: true
TocOpen: false
hidemeta: false
#comments: false
#description: "Desc Text."
#canonicalURL: "https://canonical.url/to/page"
disableHLJS: false # to disable highlightjs
disableShare: false
hideSummary: false
searchHidden: false
ShowReadingTime: true
ShowBreadCrumbs: true
ShowPostNavLinks: true
ShowWordCount: true
ShowRssButtonInSectionTermList: true
UseHugoToc: true
cover:
    image: "images/cover.jpg" # image path/url
    alt: "<alt text>" # alt text
    caption: "Photo Credit: [Unsplash](https://unsplash.com/photos/RChZT-JlI9g)" # display caption under cover
    relative: true # when using page bundles set this to true
    hidden: true # only hide on current single page
#editPost:
#    URL: "https://github.com/Aidenwebb/aidenwebb-com-blog-code/content"
#    Text: "Suggest Changes" # edit text
#    appendFilePath: true # to append file path to Edit link
---

Yesterday Microsoft announced a new critical vulnerability [CVE-2023-23397](https://msrc.microsoft.com/update-guide/vulnerability/CVE-2023-23397), a vulnerability in Microsoft Outlook that allows a threat actor to harvest NTLMv2 hashes via a specifically crafted Outlook appointment. 

Microsoft state that attackers can exploit this vulnerability by sending an email that triggers automatically when it is retrieved and processed by the Outlook client. This can lead to exploitation BEFORE the email is viewed in the Preview Pane.

They also state that this vulnerability is being actively exploited in the wild.

In the interest of quickly checking and triggering patches on affected systems, the below Powershell oneliner will report the patch status and office version on the system it runs on, and if the system is unpatched, it will attempt to run the ClickToRun updater.

Please modify it as required to suite your needs and different office versions. 
This was written to target [Microsoft 365 Apps on Current Channel](https://learn.microsoft.com/en-us/officeupdates/microsoft365-apps-security-updates).

```Powershell
$env:computername ; Get-ItemProperty -Path 'HKLM:\SOFTWARE\Microsoft\Office\ClickToRun\Configuration' | Select-Object -ExpandProperty VersionToReport | %{if($_ -eq "16.0.16130.20306"){Write-Host -ForegroundColor Green "Patched - Office Version: $_"} else {Write-Host -ForegroundColor Red "Vulnerable - Office Version: $_";  Start-Process -FilePath "C:\Program Files\Common Files\microsoft shared\ClickToRun\OfficeC2RClient.exe" -ArgumentList {/update user}}}
```

And across multiple lines for readability:

```Powershell
$env:computername
Get-ItemProperty -Path 'HKLM:\SOFTWARE\Microsoft\Office\ClickToRun\Configuration' | Select-Object -ExpandProperty VersionToReport | %{
    if($_ -eq "16.0.16130.20306"){
        Write-Host -ForegroundColor Green "Patched - Office Version: $_"
    } else {
        Write-Host -ForegroundColor Red "Vulnerable - Office Version: $_"
        Start-Process -FilePath "C:\Program Files\Common Files\microsoft shared\ClickToRun\OfficeC2RClient.exe" -ArgumentList {/update user}
    }
}
```
